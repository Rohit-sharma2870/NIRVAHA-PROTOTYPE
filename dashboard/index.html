<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NIRVĀHA Dashboard</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; max-width: 640px; }
      .row { display: flex; gap: 1rem; align-items: center; }
      .badge { padding: 4px 10px; border-radius: 999px; background: #eee; }
      .state-ATTENTIVE { background: #d7ffd9; }
      .state-DROWSY { background: #ffe1e1; }
      .state-DISTRACTED { background: #fff5cc; }
      .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: .75rem; margin-top: 1rem; }
      .metric { background: #fafafa; border: 1px solid #eee; border-radius: 8px; padding: .5rem; }
      small { color: #666; }
    </style>
  </head>
  <body>
    <h1>NIRVĀHA — Driver State</h1>
    <div class="card">
      <div class="row">
        <div>State:</div>
        <div id="state" class="badge">--</div>
        <div>Score:</div>
        <div id="score" class="badge">--</div>
        <div><small id="ts"></small></div>
      </div>
      <div class="metrics">
        <div class="metric">EAR: <b id="ear">--</b></div>
        <div class="metric">Blink: <b id="blink">--</b></div>
        <div class="metric">Gaze Off: <b id="gaze">--</b></div>
      </div>
    </div>
    <script>
      async function tick(){
        try{
          const r = await fetch("http://127.0.0.1:8000/state");
          const d = await r.json();
          const stateEl = document.getElementById("state");
          stateEl.textContent = d.state;
          stateEl.className = "badge state-" + d.state;
          document.getElementById("score").textContent = d.score.toFixed(2);
          document.getElementById("ear").textContent = (d.metrics.ear ?? 0).toFixed(2);
          document.getElementById("blink").textContent = d.metrics.blink ?? 0;
          document.getElementById("gaze").textContent = d.metrics.gaze_off ?? 0;
          document.getElementById("ts").textContent = new Date(d.ts*1000).toLocaleTimeString();
        }catch(e){ console.log(e); }
        setTimeout(tick, 1000);
      }
      tick();
    </script>
  </body>
</html>
